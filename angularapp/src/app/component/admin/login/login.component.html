<div class="login-page">
  <header class="header" [class.scrolled]="isScrolled">
    <div class="logo">
      <i class="fas fa-chart-line"></i>
      <span>Appraise360</span>
    </div>
    <nav>
      <a routerLink="/" class="btn-primary">Home</a>
      <a routerLink="/signup" class="btn-secondary">Sign Up</a>
    </nav>
  </header>

  <div class="login-container">
    <div class="login-card">
    <h2 class="title">Sign in to your dashboard</h2>

    <form (ngSubmit)="onLogin()" #loginForm="ngForm" class="form">
      <!-- Work Email -->
      <div class="input-group ">
        <label for="email">Work Email</label>
        <input
          type="email"
          id="email"
          name="email"
          [(ngModel)]="loginData.email"
          placeholder="you@company.com"
          required
        />
      </div>

      <!-- Phone Number -->
      <div class="input-group">
        <label for="phone">Phone Number</label>
        <input
          type="text"
          id="phone"
          name="phone"
          [(ngModel)]="loginData.phone"
          placeholder="9876543210"
          required
        />
      </div>

      <!-- Password -->
      <div class="input-group password-container">
        <label for="password">Password</label>
        <input
          [type]="showPassword ? 'text' : 'password'"
          id="password"
          name="password"
          [(ngModel)]="loginData.password"
          placeholder="••••••••"
          required
        />
        <i
          class="fas password-toggle-icon"
          [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"
          (click)="togglePassword()"
        ></i>
      </div>

      <!-- Login Button -->
      <!-- Error Message -->
      <div *ngIf="errorMessage" class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        {{ errorMessage }}
      </div>

      <button type="submit" class="btn-primary" [disabled]="isLoading">
        <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
        {{ isLoading ? 'Signing In...' : 'Log In' }}
      </button>
    </form>

    <!-- Helper Links -->
    <div class="helper-links">
      <a (click)="showForgotPassword = true">Forgot password?</a>
      <div class="signup-text">
        Don't have an account?
        <!-- RouterLink to SignupComponent -->
        <a [routerLink]="['/signup']" class="signup-link">Sign Up</a>
      </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="forgot-password-modal" *ngIf="showForgotPassword" (click)="closeForgotPassword()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Reset Password</h3>
          <button class="close-btn" (click)="closeForgotPassword()">&times;</button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="onForgotPasswordSubmit(forgotForm)" #forgotForm="ngForm">
            <!-- Email -->
            <div class="input-group">
              <label for="resetEmail">Email Address</label>
              <input
                type="email"
                id="resetEmail"
                name="resetEmail"
                [(ngModel)]="forgotPasswordData.email"
                placeholder="you@company.com"
                required
                email
                #resetEmail="ngModel"
              />
              <div *ngIf="resetEmail.invalid && resetEmail.touched" class="error">Valid email required</div>
            </div>

            <!-- New Password -->
            <div class="input-group password-container">
              <label for="newPassword">New Password</label>
              <input
                [type]="showNewPassword ? 'text' : 'password'"
                id="newPassword"
                name="newPassword"
                [(ngModel)]="forgotPasswordData.newPassword"
                placeholder="Enter new password"
                required
                minlength="6"
                #newPassword="ngModel"
              />
              <i class="fas password-toggle-icon" [ngClass]="showNewPassword ? 'fa-eye-slash' : 'fa-eye'" (click)="toggleNewPassword()"></i>
              <div *ngIf="newPassword.invalid && newPassword.touched" class="error">
                <div *ngIf="newPassword.errors?.['required']">New password is required</div>
                <div *ngIf="newPassword.errors?.['minlength']">Password must be at least 6 characters</div>
              </div>
            </div>

            <!-- Confirm New Password -->
            <div class="input-group password-container">
              <label for="confirmNewPassword">Confirm New Password</label>
              <input
                [type]="showConfirmNewPassword ? 'text' : 'password'"
                id="confirmNewPassword"
                name="confirmNewPassword"
                [(ngModel)]="forgotPasswordData.confirmNewPassword"
                placeholder="Confirm new password"
                required
                (input)="checkNewPasswordMatch()"
                #confirmNewPassword="ngModel"
              />
              <i class="fas password-toggle-icon" [ngClass]="showConfirmNewPassword ? 'fa-eye-slash' : 'fa-eye'" (click)="toggleConfirmNewPassword()"></i>
              <div *ngIf="confirmNewPassword.invalid && confirmNewPassword.touched" class="error">
                <div *ngIf="confirmNewPassword.errors?.['required']">Please confirm your new password</div>
              </div>
              <div *ngIf="newPasswordMismatch" class="error">Passwords do not match</div>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn-secondary" (click)="closeForgotPassword()">Cancel</button>
              <button type="submit" class="btn-primary" [disabled]="!isForgotPasswordFormValid() || isForgotPasswordLoading">
                <i *ngIf="isForgotPasswordLoading" class="fas fa-spinner fa-spin"></i>
                {{ isForgotPasswordLoading ? 'Resetting...' : 'Reset Password' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
