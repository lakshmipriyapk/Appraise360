<div class="layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2 class="logo">
      <i class="fas fa-chart-line"></i>
      Appraise360
    </h2>
    <ul>
      <li *ngFor="let item of menuItems" (click)="navigateTo(item.route)" [class.active]="item.route === '/employee-profile'">
        <i [ngClass]="['fas', item.icon]"></i> {{ item.title }}
      </li>
    </ul>
  </aside>

  <!-- Main content -->
  <div class="main">
    <!-- Topbar -->
    <header class="topbar">
      <div class="topbar-left">
        <h1>Employee Profiles</h1>
        <p class="subtitle">View and manage employee profiles for appraisals and reviews</p>
      </div>
      <div class="topbar-right">
        <div class="user-info">
          <i class="fas fa-user-circle"></i>
          <span>Admin User</span>
        </div>
        <button class="logout-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </header>

    <!-- Employee Profile Management Content -->
    <div class="dashboard-content">
      <div class="employee-profile-container">

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Search by name, email, designation, or department..." 
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        class="search-input">
    </div>
    
    <div class="filter-controls">
      <select 
        [(ngModel)]="departmentFilter" 
        (change)="onDepartmentFilterChange()"
        class="filter-select">
        <option value="">All Departments</option>
        <option *ngFor="let dept of getDepartments()" [value]="dept">{{ dept }}</option>
      </select>
      
      <button class="view-profiles-btn" (click)="refreshProfiles()">
        <i class="fas fa-sync-alt"></i> Refresh Profiles
      </button>
    </div>
  </div>

        <!-- Error Message -->
        <div class="error-message" *ngIf="errorMessage">
      <i class="fas fa-exclamation-circle"></i>
      {{ errorMessage }}
  </div>

        <!-- Success Message -->
        <div class="success-message" *ngIf="successMessage">
      <i class="fas fa-check-circle"></i>
      {{ successMessage }}
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading employee profiles...</p>
  </div>

        <!-- Employee Profiles List -->
        <div class="employee-profiles-list" *ngIf="!isLoading && !showDetailView">
          <div class="list-header">
            <h3>Employee List</h3>
            <span class="count">{{ filteredEmployeeProfiles.length }} employees</span>
          </div>
          
          <div class="table-container">
            <table class="employee-table">
              <thead>
                <tr>
                  <th>Employee ID</th>
                  <th>Full Name</th>
                  <th>Department</th>
                  <th>Designation</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let profile of filteredEmployeeProfiles" class="employee-row">
                  <td>{{ profile.employeeId }}</td>
                  <td>{{ profile.fullName }}</td>
                  <td>
                    <span class="department-badge">{{ profile.department }}</span>
                  </td>
                  <td>{{ profile.designation }}</td>
                  <td>{{ profile.email }}</td>
                  <td>{{ profile.phoneNumber || 'Not provided' }}</td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn btn-sm btn-primary" (click)="viewEmployeeDetails(profile)" title="View Details">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-warning" (click)="editEmployeeDetails(profile)" title="Edit Details">
                        <i class="fas fa-edit"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Employee Detail View -->
        <div class="employee-detail-view" *ngIf="showDetailView && selectedEmployeeProfile && !showEditForm">
          <div class="detail-header">
            <button class="btn btn-secondary" (click)="closeDetailView()">
              <i class="fas fa-arrow-left"></i> Back to List
            </button>
            <h3>Employee Profile Details</h3>
            <button class="btn btn-primary" (click)="editEmployeeDetails(selectedEmployeeProfile)">
              <i class="fas fa-edit"></i> Edit Profile
            </button>
          </div>

          <div class="profile-detail-card">
      <div class="profile-header">
        <div class="profile-avatar">
          <i class="fas fa-user"></i>
        </div>
        <div class="profile-info">
                <h3>{{ selectedEmployeeProfile.fullName }}</h3>
                <p>{{ selectedEmployeeProfile.designation }}</p>
                <span class="employee-id">ID: {{ selectedEmployeeProfile.employeeId }}</span>
        </div>
      </div>

      <div class="profile-details">
        <!-- Basic Information -->
        <div class="detail-section">
          <h4 class="section-title">Basic Information</h4>
          <div class="detail-item">
            <span class="detail-label">Employee ID:</span>
                  <span class="detail-value">{{ selectedEmployeeProfile.employeeId }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Full Name:</span>
                  <span class="detail-value">{{ selectedEmployeeProfile.fullName }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Email:</span>
                  <span class="detail-value">{{ selectedEmployeeProfile.email }}</span>
          </div>
          <div class="detail-item">
                  <span class="detail-label">Phone Number:</span>
                  <span class="detail-value">{{ selectedEmployeeProfile.phoneNumber || 'Not provided' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Department:</span>
                  <span class="detail-value department-badge">{{ selectedEmployeeProfile.department }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Designation:</span>
                  <span class="detail-value">{{ selectedEmployeeProfile.designation }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Date of Joining:</span>
                  <span class="detail-value">{{ formatDate(selectedEmployeeProfile.dateOfJoining) }}</span>
          </div>
        </div>

        <!-- Work Details -->
        <div class="detail-section">
          <h4 class="section-title">Work Details</h4>
          <div class="detail-item">
            <span class="detail-label">Current Project:</span>
                  <span class="detail-value">{{ selectedEmployeeProfile.currentProject || 'Not assigned' }}</span>
          </div>
                <div class="detail-item">
            <span class="detail-label">Current Team:</span>
                  <span class="detail-value">{{ selectedEmployeeProfile.currentTeam || 'Not assigned' }}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">Reporting Manager:</span>
                  <span class="detail-value">{{ selectedEmployeeProfile.reportingManager || 'Not assigned' }}</span>
          </div>
                <div class="detail-item" *ngIf="selectedEmployeeProfile.skills">
            <span class="detail-label">Skills:</span>
            <div class="skills-container">
                    <span *ngFor="let skill of selectedEmployeeProfile.skills.split(',')" class="skill-badge">{{ skill.trim() }}</span>
            </div>
          </div>
        </div>

        <!-- Performance Summary -->
        <div class="detail-section">
          <h4 class="section-title">Performance Summary</h4>
          <div class="detail-item">
            <span class="detail-label">Last Appraisal Rating:</span>
                  <span class="detail-value" [ngClass]="getRatingClass(selectedEmployeeProfile.lastAppraisalRating)">
                    {{ selectedEmployeeProfile.lastAppraisalRating || 'No rating yet' }}
            </span>
          </div>
              </div>
      </div>
    </div>
  </div>

  <!-- Employee Edit Form -->
  <div class="employee-edit-form" *ngIf="showEditForm && selectedEmployeeProfile">
    <div class="edit-header">
      <button class="btn btn-secondary" (click)="cancelEdit()">
        <i class="fas fa-arrow-left"></i> Back to Details
      </button>
      <h3>Edit Employee Profile</h3>
    </div>

    <form [formGroup]="editForm" (ngSubmit)="saveEmployeeProfile()" class="edit-form">
      <!-- Basic Information -->
      <div class="form-section">
        <h4>Basic Information</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="fullName">Full Name *</label>
            <input type="text" id="fullName" formControlName="fullName" class="form-control">
            <div class="error-message" *ngIf="editForm.get('fullName')?.invalid && editForm.get('fullName')?.touched">
              Full name is required
            </div>
          </div>
          <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" formControlName="email" class="form-control">
            <div class="error-message" *ngIf="editForm.get('email')?.invalid && editForm.get('email')?.touched">
              Valid email is required
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="phoneNumber">Phone Number</label>
            <input type="tel" id="phoneNumber" formControlName="phoneNumber" class="form-control">
          </div>
          <div class="form-group">
            <label for="dateOfJoining">Date of Joining</label>
            <input type="date" id="dateOfJoining" formControlName="dateOfJoining" class="form-control">
          </div>
        </div>
      </div>

      <!-- Work Information -->
      <div class="form-section">
        <h4>Work Information</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="department">Department *</label>
            <select id="department" formControlName="department" class="form-control">
              <option value="">Select Department</option>
              <option value="IT">IT</option>
              <option value="HR">HR</option>
              <option value="Finance">Finance</option>
              <option value="Marketing">Marketing</option>
              <option value="Operations">Operations</option>
              <option value="Sales">Sales</option>
            </select>
            <div class="error-message" *ngIf="editForm.get('department')?.invalid && editForm.get('department')?.touched">
              Department is required
            </div>
          </div>
          <div class="form-group">
            <label for="designation">Designation *</label>
            <input type="text" id="designation" formControlName="designation" class="form-control">
            <div class="error-message" *ngIf="editForm.get('designation')?.invalid && editForm.get('designation')?.touched">
              Designation is required
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="currentProject">Current Project</label>
            <input type="text" id="currentProject" formControlName="currentProject" class="form-control">
          </div>
          <div class="form-group">
            <label for="currentTeam">Current Team</label>
            <input type="text" id="currentTeam" formControlName="currentTeam" class="form-control">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="reportingManager">Reporting Manager</label>
            <input type="text" id="reportingManager" formControlName="reportingManager" class="form-control">
          </div>
          <div class="form-group">
            <label for="skills">Skills</label>
            <input type="text" id="skills" formControlName="skills" class="form-control" placeholder="Comma-separated skills">
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancelEdit()">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid || isSaving">
          <i class="fas fa-save"></i> {{ isSaving ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Empty State -->
        <div class="empty-state" *ngIf="!isLoading && filteredEmployeeProfiles.length === 0 && !showDetailView">
    <i class="fas fa-users"></i>
    <h3>No Employee Profiles Found</h3>
    <p *ngIf="searchTerm || departmentFilter">Try adjusting your search criteria</p>
    <p *ngIf="!searchTerm && !departmentFilter">No employee profiles are available yet</p>
  </div>

      </div> <!-- End employee-profile-container -->
    </div> <!-- End dashboard-content -->
  </div> <!-- End main -->
</div> <!-- End layout -->