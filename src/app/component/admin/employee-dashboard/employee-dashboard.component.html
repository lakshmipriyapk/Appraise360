
<div class="employee-dashboard">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Loading your dashboard...</p>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ errorMessage }}</p>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="!isLoading && !errorMessage" class="dashboard-layout">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <i class="fas fa-chart-line"></i>
          <span>Appraise360</span>
        </div>
        <div class="employee-info" *ngIf="currentEmployee">
          <div class="employee-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="employee-details">
            <h3>{{ currentEmployee.user.firstName }} {{ currentEmployee.user.lastName }}</h3>
            <p>{{ currentEmployee.designation }}</p>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <ul>
          <li *ngFor="let item of menuItems" 
              [class.active]="activeSection === item.route"
              (click)="navigateToSection(item.route)">
            <i [class]="'fas ' + item.icon"></i>
            <span>{{ item.title }}</span>
          </li>
        </ul>
      </nav>

      <div class="sidebar-footer">
        <button class="logout-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </button>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Top Bar -->
      <header class="topbar">
        <div class="topbar-left">
          <h1>{{ getSectionTitle() }}</h1>
          <p class="breadcrumb">{{ getBreadcrumb() }}</p>
        </div>
        <div class="topbar-right">
          <div class="notification-bell">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">3</span>
          </div>
          <div class="user-menu">
            <div class="user-avatar">
              <i class="fas fa-user"></i>
            </div>
          </div>
        </div>
      </header>

      <!-- Dashboard Content -->
      <div class="content-area">
        <!-- Overview Section -->
        <div *ngIf="activeSection === 'overview'" class="overview-section">
          <!-- Stats Cards -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-bullseye"></i>
              </div>
              <div class="stat-content">
                <h3>{{ dashboardStats.totalGoals }}</h3>
                <p>Total Goals</p>
                <div class="stat-progress">
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="getGoalProgressPercentage()"></div>
                  </div>
                  <span>{{ getGoalProgressPercentage() }}% Complete</span>
                </div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-star"></i>
              </div>
              <div class="stat-content">
                <h3>{{ dashboardStats.lastAppraisalRating | number:'1.1-1' }}</h3>
                <p>Latest Rating</p>
                <div class="rating-display">
                  <div class="stars">
                    <i *ngFor="let star of [1,2,3,4,5]" 
                       [class]="'fas fa-star ' + (star <= dashboardStats.lastAppraisalRating ? 'filled' : '')"></i>
                  </div>
                </div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-comments"></i>
              </div>
              <div class="stat-content">
                <h3>{{ dashboardStats.feedbackCount }}</h3>
                <p>Feedback Received</p>
                <div class="feedback-summary">
                  <span class="recent-count">{{ recentFeedback.length }} Recent</span>
                </div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="stat-content">
                <h3>{{ dashboardStats.averageRating | number:'1.1-1' }}</h3>
                <p>Average Rating</p>
                <div class="trend-indicator">
                  <i class="fas fa-arrow-up"></i>
                  <span>+0.3 from last cycle</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <h2>Quick Actions</h2>
            <div class="action-buttons">
              <button class="action-btn" (click)="navigateToSection('goals')">
                <i class="fas fa-plus"></i>
                <span>Add New Goal</span>
              </button>
              <button class="action-btn" (click)="navigateToSection('feedback')">
                <i class="fas fa-comment"></i>
                <span>Request Feedback</span>
              </button>
              <button class="action-btn" (click)="navigateToSection('appraisals')">
                <i class="fas fa-clipboard-check"></i>
                <span>View Appraisals</span>
              </button>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="recent-activity">
            <h2>Recent Activity</h2>
            <div class="activity-list">
              <div class="activity-item" *ngFor="let feedback of recentFeedback">
                <div class="activity-icon">
                  <i class="fas fa-comment"></i>
                </div>
                <div class="activity-content">
                  <h4>{{ feedback.feedbackType }} Feedback</h4>
                  <p>{{ feedback.comments }}</p>
                  <span class="activity-time">{{ feedback.reviewer.firstName }} {{ feedback.reviewer.lastName }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Goals Section -->
        <div *ngIf="activeSection === 'goals'" class="goals-section">
          <div class="section-header">
            <h2>My Goals</h2>
            <button class="btn-primary">
              <i class="fas fa-plus"></i>
              Add New Goal
            </button>
          </div>

          <div class="goals-grid">
            <div class="goal-card" *ngFor="let goal of currentGoals">
              <div class="goal-header">
                <h3>{{ goal.title }}</h3>
                <span class="goal-status" [style.background-color]="getStatusColor(goal.status)">
                  {{ goal.status }}
                </span>
              </div>
              <p class="goal-description">{{ goal.description }}</p>
              <div class="goal-progress">
                <div class="progress-bar">
                  <div class="progress-fill" 
                       [style.width.%]="goal.status === 'Completed' ? 100 : goal.status === 'In Progress' ? 50 : 0">
                  </div>
                </div>
                <span class="progress-text">
                  {{ goal.status === 'Completed' ? '100%' : goal.status === 'In Progress' ? '50%' : '0%' }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Feedback Section -->
        <div *ngIf="activeSection === 'feedback'" class="feedback-section">
          <div class="section-header">
            <h2>Feedback</h2>
            <button class="btn-primary">
              <i class="fas fa-plus"></i>
              Request Feedback
            </button>
          </div>

          <div class="feedback-list">
            <div class="feedback-card" *ngFor="let feedback of recentFeedback">
              <div class="feedback-header">
                <div class="feedback-type">
                  <i class="fas fa-user"></i>
                  <span>{{ feedback.feedbackType }}</span>
                </div>
                <div class="feedback-rating" *ngIf="feedback.rating">
                  <div class="stars">
                    <i *ngFor="let star of [1,2,3,4,5]" 
                       [class]="'fas fa-star ' + (star <= feedback.rating! ? 'filled' : '')"></i>
                  </div>
                </div>
              </div>
              <p class="feedback-comment">{{ feedback.comments }}</p>
              <div class="feedback-footer">
                <span class="reviewer">{{ feedback.reviewer.firstName }} {{ feedback.reviewer.lastName }}</span>
                <span class="feedback-date">2 days ago</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Appraisals Section -->
        <div *ngIf="activeSection === 'appraisals'" class="appraisals-section">
          <div class="section-header">
            <h2>Performance Appraisals</h2>
          </div>

          <div class="appraisals-list">
            <div class="appraisal-card" *ngFor="let appraisal of appraisals">
              <div class="appraisal-header">
                <h3>Appraisal #{{ appraisal.appraisalId }}</h3>
                <span class="appraisal-status" [style.background-color]="getStatusColor(appraisal.status)">
                  {{ appraisal.status }}
                </span>
              </div>
              <div class="appraisal-ratings">
                <div class="rating-item">
                  <label>Self Rating:</label>
                  <div class="rating-display">
                    <div class="stars">
                      <i *ngFor="let star of [1,2,3,4,5]" 
                         [class]="'fas fa-star ' + (star <= appraisal.selfRating ? 'filled' : '')"></i>
                    </div>
                    <span class="rating-number">{{ appraisal.selfRating }}</span>
                  </div>
                </div>
                <div class="rating-item">
                  <label>Manager Rating:</label>
                  <div class="rating-display">
                    <div class="stars">
                      <i *ngFor="let star of [1,2,3,4,5]" 
                         [class]="'fas fa-star ' + (star <= appraisal.managerRating ? 'filled' : '')"></i>
                    </div>
                    <span class="rating-number">{{ appraisal.managerRating }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Profile Section -->
        <div *ngIf="activeSection === 'profile'" class="profile-section">
          <div class="section-header">
            <h2>My Profile</h2>
            <button class="btn-secondary">
              <i class="fas fa-edit"></i>
              Edit Profile
            </button>
          </div>

          <div class="profile-content" *ngIf="currentEmployee">
            <div class="profile-card">
              <div class="profile-header">
                <div class="profile-avatar">
                  <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                  <h3>{{ currentEmployee.user.firstName }} {{ currentEmployee.user.lastName }}</h3>
                  <p>{{ currentEmployee.designation }}</p>
                  <span class="employee-id">ID: {{ currentEmployee.employeeProfileId }}</span>
                </div>
              </div>

              <div class="profile-details">
                <div class="detail-row">
                  <label>Email:</label>
                  <span>{{ currentEmployee.user.email }}</span>
                </div>
                <div class="detail-row">
                  <label>Department:</label>
                  <span>{{ currentEmployee.department }}</span>
                </div>
                <div class="detail-row">
                  <label>Date of Joining:</label>
                  <span>{{ currentEmployee.dateOfJoining | date:'mediumDate' }}</span>
                </div>
                <div class="detail-row">
                  <label>Reporting Manager:</label>
                  <span>{{ currentEmployee.reportingManager }}</span>
                </div>
                <div class="detail-row">
                  <label>Current Project:</label>
                  <span>{{ currentEmployee.currentProject }}</span>
                </div>
                <div class="detail-row">
                  <label>Current Team:</label>
                  <span>{{ currentEmployee.currentTeam }}</span>
                </div>
              </div>

              <div class="skills-section">
                <h4>Skills</h4>
                <div class="skills-list">
                  <span class="skill-tag" *ngFor="let skill of currentEmployee.skills">
                    {{ skill }}
                  </span>
                </div>
              </div>

              <div class="goals-section">
                <h4>Current Goals</h4>
                <div class="goals-list">
                  <span class="goal-tag" *ngFor="let goal of currentEmployee.currentGoals">
                    {{ goal }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
